$(document).ready(function(){
	
	var scrollCookie = $.cookie('scroll_cookie');
	$.removeCookie('scroll_cookie');
	$(document).scrollTop(scrollCookie);
	
	$('.link-button')
	  .button()
	  .css({visibility: "visible"});
	
	$("#date-select").datepicker({
		onSelect: function(date, instance) {
			var newdate = new Date(date);
			var ms = newdate.valueOf();
			var timeStamp = ms/1000;
			window.location = "?date="+timeStamp;
		}
	});	
		
	$('#date-select').val(gon.date);
	
	var scroll = 1000;
	$(".event").each(function(){
		var topVal = $(this).position().top;
		if(topVal<scroll)
		{
			scroll = topVal;
		}
	});
	if (scrollCookie === undefined)
	{
	$(document).scrollTop(scroll);
	}
	
//  dialog for attendance	
	
	$('.event').click(function(){
		var id = $(this).attr('id').split("-", 1);
		$.ajax({
	    	url: "/attendances/dialog",
	        data: "lesson_id="+id+"&date="+gon.ruby_date,
	        type: "GET",
			success: function(result)
			{
				$('#attendance-dialog').html(result);
			}
	   	}); 
		
		$( "#attendance-dialog" ).dialog(
			{buttons:[
                {
                    text: "Cancel", click: function() {
                        $( this ).dialog( "close" );
                    }
                },
                {
                	text: "Submit", click: function() {
						var scrollCookie = $(document).scrollTop();
						$.cookie('scroll_cookie', scrollCookie);
						$('#submit').trigger('click');
                       // $( this ).dialog( "close" );
                    }
                }
            ]},
            {"modal": "true"}
        );
		
	});
});